

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Pavilion &mdash; Pavilion2 2.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'2.0.0',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Pavilion2
          

          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Pavilion</a><ul>
<li><a class="reference internal" href="#project-goals">Project goals:</a></li>
<li><a class="reference internal" href="#contents">Contents</a></li>
<li><a class="reference internal" href="#basic-usage">Basic Usage</a><ul>
<li><a class="reference internal" href="#setup">Setup</a></li>
<li><a class="reference internal" href="#configure-tests">Configure Tests</a><ul>
<li><a class="reference internal" href="#host-configs">Host Configs</a></li>
<li><a class="reference internal" href="#mode-configs">Mode Configs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-tests">Running tests</a><ul>
<li><a class="reference internal" href="#test-status">Test Status</a></li>
</ul>
</li>
<li><a class="reference internal" href="#test-series-and-id-s">Test Series and ID’s</a></li>
<li><a class="reference internal" href="#test-results">Test Results</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Pavilion2</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Pavilion</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/basics.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pavilion">
<h1>Pavilion<a class="headerlink" href="#pavilion" title="Permalink to this headline">¶</a></h1>
<p>Pavilion is a Python 3 (3.4+) based framework for running and analyzing
tests targeting HPC systems. It provides a rich YAML-based configuration
system for wrapping test codes and running them against various systems.
The vast majority of the system is defined via plugins,, giving users
the ability to extend and modify Pavilion’s operation to suit their
needs. Plugin components include those for gathering system data, adding
additional schedulers, parsing test results, and more.</p>
<div class="section" id="project-goals">
<h2>Project goals:<a class="headerlink" href="#project-goals" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Robust testing in postDST, automated, and acceptance testing (system
validation) scenarios.</li>
<li>End-to-end status tracking for all tests.</li>
<li>Simple, powerful test configuration language.</li>
<li>System agnostic test configs.</li>
<li>Hide common platform and environment idiosyncrasies from tests.</li>
<li>System specific defaults.</li>
<li>Eliminate unnecessary build repetition.</li>
<li>Extreme extensibility (plugins everywhere).</li>
</ul>
</div>
<div class="section" id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="#basic-usage">Basic Usage</a></li>
<li><a class="reference external" href="advanced.md">Advanced Usage</a></li>
<li><a class="reference external" href="install.md">Installation</a></li>
<li><a class="reference external" href="config.md">Configuring Pavilion</a><ul>
<li><a class="reference external" href="config.md#config-directories">Config Directories</a></li>
</ul>
</li>
<li><a class="reference external" href="tests/basics.md">Writing Tests</a></li>
<li><a class="reference external" href="tests/build.md">Building</a></li>
<li><a class="reference external" href="tests/run.md">Running</a></li>
<li><a class="reference external" href="tests/env.md">Environment</a></li>
<li><a class="reference external" href="tests/sched.md">Scheduling</a> (To be written)</li>
<li><a class="reference external" href="tests/results.md">Results</a></li>
<li><a class="reference external" href="tests/variables.md">Variables</a></li>
<li><a class="reference external" href="tests/variables.md#permutations">Permutations</a></li>
<li><a class="reference external" href="plugins/basics.md">Plugins and Customization</a></li>
<li><a class="reference external" href="plugins/sys_vars.md">System Variables</a></li>
<li><a class="reference external" href="plugins/module_wrappers.md">Module Wrappers</a></li>
<li><a class="reference external" href="plugins/result_parsers.md">Result Parsers</a> (To be written)</li>
<li><a class="reference external" href="plugins/schedulers.md">Schedulers</a> (To be written)</li>
<li><a class="reference external" href="plugins/commands.md">Commands</a></li>
<li><a class="reference external" href="LICENSE.md">License</a></li>
</ul>
</div>
<div class="section" id="basic-usage">
<h2>Basic Usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="#setup">Setup</a></li>
<li><a class="reference external" href="#configure-tests">Configuring Tests</a></li>
<li><a class="reference external" href="#running-tests">Running Tests</a></li>
<li><a class="reference external" href="#test-status">Test Status</a></li>
<li><a class="reference external" href="#test-results">Test Results</a></li>
</ul>
<div class="section" id="setup">
<h3>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h3>
<p><em>See the `install docs &lt;install.md&gt;`__ if you need to install Pavilion</em></p>
<p>Add the PAV bin directory to your Path.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>PATH=&lt;PVINSTALL_PATH&gt;/bin:${PATH}
</pre></div>
</div>
<p>Pavilion figures out paths to everything else on it’s own.</p>
<p>Then simply run pavilion:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">pav</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-tests">
<h3>Configure Tests<a class="headerlink" href="#configure-tests" title="Permalink to this headline">¶</a></h3>
<p>Pavilion doesn’t come with any tests itself, it’s just a system for
running them on HPC clusters. Each test needs a configuration script,
and most will need some source files. Both of these will live in one of
your <a class="reference external" href="config.md#config-directories">config directories</a> under the
<code class="docutils literal"><span class="pre">tests/</span></code> and <code class="docutils literal"><span class="pre">test_src/</span></code> sub-directories.</p>
<p>Test configs tell pavilion what environment it needs to build and run
your test, the commands to run it, how to schedule it on a cluster, and
how to parse the results. Don’t worry if it seems like a lot, tests can
be as simple as a single command, just about everything in the config is
optional.</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Tests are in a strictly defined YAML format.</span>

<span class="c1"># This defines a test, and names it.</span>
<span class="n">mytest</span><span class="p">:</span>

  <span class="c1"># The scheduler to use to schedule the test on a cluster.</span>
  <span class="c1"># In this case, we&#39;ll use the raw (local system) scheduler</span>
  <span class="n">scheduler</span><span class="p">:</span> <span class="n">raw</span>
  <span class="n">run</span><span class="p">:</span>
    <span class="n">cmds</span><span class="p">:</span> <span class="s1">&#39;test -d /var/log/messages&#39;</span>
</pre></div>
</div>
<p>The above test checks to see if the <code class="docutils literal"><span class="pre">/var/log/messages</span></code> directory
exits. - The test will PASS if that command returns 0. - It will run as
a process on the local machine, as your user. - Pavilion doesn’t have
any special priviledges. It’s meant to test things, from a normal users
perspective. If you want to test stuff as root, you’ll have to run
pavilion as root.</p>
<div class="section" id="host-configs">
<h4>Host Configs<a class="headerlink" href="#host-configs" title="Permalink to this headline">¶</a></h4>
<p>Every system(host) that you run tests on will need a host configuration
file. These are located in <code class="docutils literal"><span class="pre">hosts/&lt;sys_name&gt;.yaml</span></code> in a pavilion
config directory.</p>
<p>This config is used to override the Pavilion defaults for values in
every test config run on that system. You can use these to set default
values for things like the max nodes per job in a given scheduler,
always loading certain modules when building tests, or setting useful
<a class="reference external" href="tests/variables.md">variables</a> for that system. The format is the
same as a test config file, except with only one test and without the
name for that test.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>$ cat hosts/my_host.yaml

scheduler: slurm
</pre></div>
</div>
<p>The above host config would set the default scheduler to ‘slurm’ for
tests kicked off on a host with a hostname of <code class="docutils literal"><span class="pre">my_host</span></code>. Pavilion uses
the contents of the <code class="docutils literal"><span class="pre">sys_name</span></code> test config variable to determine the
current host, which is provided via a built-in <a class="reference external" href="plugins/sys_vars.md">system variable
plugin</a>. This behaviour can be overridden by
providing your own sys_var plugin, which is especially useful on
clusters with multiple front-ends.</p>
</div>
<div class="section" id="mode-configs">
<h4>Mode Configs<a class="headerlink" href="#mode-configs" title="Permalink to this headline">¶</a></h4>
<p>In addition to host config files, you can provide mode config files that
you can apply to any test when you run it. They have the same format as
the host configs, but multiple can be provided per test.</p>
<p>For example, the following mode file could be used to set a particular
set of slurm vars. It would reside in <code class="docutils literal"><span class="pre">modes/tester.yaml</span></code> in a
pavilion config directory.</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="n">slurm</span><span class="p">:</span>
    <span class="n">account</span><span class="p">:</span> <span class="n">tester</span>
    <span class="n">partition</span><span class="p">:</span> <span class="n">post</span><span class="o">-</span><span class="n">dst</span>
</pre></div>
</div>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">pav</span> <span class="n">run</span> <span class="o">-</span><span class="n">m</span> <span class="n">tester</span> <span class="o">-</span><span class="n">f</span> <span class="n">post_dst_tests</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="running-tests">
<h3>Running tests<a class="headerlink" href="#running-tests" title="Permalink to this headline">¶</a></h3>
<p>Running tests is easy. All you need is the test suite name (the name of
the test file), and the test name (the name of the test in the suite).
Did you forget what you named them? That ok! Just ask Pavilion.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>$ pav show tests
-----------------------+----------------------------------------------------
 Name                  | Summary
-----------------------+----------------------------------------------------
 hello_mpi.hello_mpi   | Builds and runs an MPI-based Hello, World program.
 hello_mpi.hello_worse | Builds and runs MPI-based Hello, World, but badly.
 supermagic.supermagic | Run all supermagic tests.

$ pav run supermagic.supermagic
1 tests started as test series s33.
</pre></div>
</div>
<p>If you want to run every test in the suite, you can just give the suite
name. You can also run whatever combinations of tests you want. You also
list tests in a file and have Pavilion read that.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>$ pav run hello_mpi
2 tests started as test series s34.

$ pav run hello_mpi.hello_mpi supermagic
2 tests started as test series s35.

$ pav run -f mytests
347 tests started as test series s36.
</pre></div>
</div>
<div class="section" id="test-status">
<h4>Test Status<a class="headerlink" href="#test-status" title="Permalink to this headline">¶</a></h4>
<p>If you want to know what’s going on with your tests, just use the
<code class="docutils literal"><span class="pre">pav</span>&#160; <span class="pre">status</span></code> command.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>$ pav status
------+------------+----------+------------------+------------------------------
 Test | Name       | State    | Time             | Note
------+------------+----------+------------------+------------------------------
 41   | supermagic | COMPLETE | 16 May 2019 10:38| Test completed successfully.
</pre></div>
</div>
<p>It will display the status of all the tests in the last test series you
ran.</p>
</div>
</div>
<div class="section" id="test-series-and-id-s">
<h3>Test Series and ID’s<a class="headerlink" href="#test-series-and-id-s" title="Permalink to this headline">¶</a></h3>
<p>From the above, you may have noticed that each test gets a series id
like <code class="docutils literal"><span class="pre">s24</span></code> and a test id like <code class="docutils literal"><span class="pre">41</span></code>. You can use these id’s to
reference tests or suites of tests to get their status, results, and
logs through the pavilion interface. The ID’s are unique for a given
Pavilion <a class="reference external" href="config.md#working_dir">working_directory</a>, but they will
get reused as old tests are cleaned up.</p>
</div>
<div class="section" id="test-results">
<h3>Test Results<a class="headerlink" href="#test-results" title="Permalink to this headline">¶</a></h3>
<p>Pavilion builds a mapping of result keys and values for every test that
runs. You can view the results of any tests using the <code class="docutils literal"><span class="pre">pav</span> <span class="pre">results</span></code>
command.</p>
<div class="line-block">
<div class="line">```bash $ pav results Test Results</div>
<div class="line">————+—-+——– Name | Id | Result
————+—-+——– supermagic | 41 | PASS</div>
</div>
<div class="line-block">
<div class="line">$ pav results –full Test Results</div>
<div class="line">————+—-+——–+———-+—————-+—————-+—————–
Name | Id | Result | Duration | Created | Started | Finished</div>
<div class="line">————+—-+——–+———-+—————-+—————-+—————–
supermagic | 41 | PASS | 3.825702 | 19-05-16 10:38 | 19-05-16
10:38 | 19-05-16 10:38 ```</div>
</div>
<p>Every test has a results object that contains at least the keys listed
above. - result - The PASS/FAIL/ERROR result for the test. - duration -
How long the test lasted in seconds (finished - started) - created -
When the test run was created - started - When the test actually started
- finished - When the test run completed</p>
<p>By default, a test passes if it’s last command returns 0. You can
override this behaviour by using <a class="reference external" href="tests/results.md">result parsers</a>.
You can also use result parsers to add additional, arbitrary values to
the test results.</p>
<p>Results are saved alongside each test, as well being written to a
central result log that is suitable for import into Splunk or other
tools.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, LANL Pre-Team

    </p>
  </div>
    
    
      Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>