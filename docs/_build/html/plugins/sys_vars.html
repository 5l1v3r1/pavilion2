
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>System Variables &#8212; Pavilion2 2.0.0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="system-variables">
<h1>System Variables<a class="headerlink" href="#system-variables" title="Permalink to this headline">¶</a></h1>
<p>System Variable (sys_var) plugins give you the ability to add new
variables that test configs can use in your environment. The variable
values are generated by a Python function that you define, which makes
the possibilities fairly limitless.</p>
<p>The general idea here is that system variables are there to tell you
information about the system/host Pavilion is running on, and the
environment that it is running in.</p>
<div class="section" id="files">
<h2>Files<a class="headerlink" href="#files" title="Permalink to this headline">¶</a></h2>
<p>System Variable plugins, like all other Pavilion plugins, require a
python module and a yapsy-plugin file. See the <a class="reference external" href="basics.md">plugin
basics</a> for more info on these files and where they should
go.</p>
</div>
<div class="section" id="system-variable-module">
<h2>System Variable Module<a class="headerlink" href="#system-variable-module" title="Permalink to this headline">¶</a></h2>
<p>A system variable module should contain a class definition that inherits
from the system variable base class.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pavilion</span> <span class="k">import</span> <span class="n">system_variables</span>

<span class="k">class</span> <span class="nc">Uptime</span><span class="p">(</span><span class="n">system_variables</span><span class="o">.</span><span class="n">SystemPlugin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is a fairly useless variable, but is a good enough example.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="c1"># The name of the plugin.</span>
            <span class="n">plugin_name</span><span class="o">=</span><span class="s2">&quot;uptime&quot;</span><span class="p">,</span>
            <span class="c1"># The description will be listed when using &#39;pav show sys_vars&#39;</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;How long the (kickoff) host has been up in seconds.&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># This is the method you override to provide the variables value.</span>
    <span class="c1"># The base .get() method handles all the deferred variable logic, so</span>
    <span class="c1"># you don&#39;t have to.</span>
    <span class="k">def</span> <span class="nf">_get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/proc/uptime&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">uptime</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">uptime</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>With this plugin in the system, we can refer to it in test configs:</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="n">uptime_test</span><span class="p">:</span>
  <span class="n">run</span><span class="p">:</span>
    <span class="n">cmds</span><span class="p">:</span> <span class="n">echo</span> <span class="p">{{</span><span class="n">sys</span><span class="o">.</span><span class="n">uptime</span><span class="p">}}</span>
</pre></div>
</div>
<div class="section" id="the-get-method">
<h3>The <code class="docutils literal"><span class="pre">_get()</span></code> Method<a class="headerlink" href="#the-get-method" title="Permalink to this headline">¶</a></h3>
<p>This should gather the information needed to compute your variables
value and then return that value. While the computation of the value can
be simple or complex, the returned value must be one of the following:</p>
<ul class="simple">
<li>A string</li>
<li>A dict with a strict set of string keys and string values</li>
<li>A list of such strings or dicts.</li>
</ul>
<p><strong>Important</strong>: If your variable can return dicts, it must always return
them. It can’t return dicts sometimes and strings other times.
Additionally, dicts returned must always have the same keys, regardless
of system or other considerations.</p>
<p>Additional restrictions apply to <a class="reference external" href="#the-is_deferrable-argument">deferred
variables</a>.</p>
</div>
<div class="section" id="the-init-method">
<h3>The <code class="docutils literal"><span class="pre">__init__()</span></code> Method<a class="headerlink" href="#the-init-method" title="Permalink to this headline">¶</a></h3>
<p>The basics of the <code class="docutils literal"><span class="pre">__init__()</span></code> method are <a href="#id1"><span class="problematic" id="id2">`covered
elsewhere &lt;basics.md#plugin-__init__&gt;`__</span></a>, as are the generic arguments
like <a class="reference external" href="basics.md#plugin-name">‘name’</a>,
<a class="reference external" href="basics.md#plugin-priority">‘priority’</a>, and
<a class="reference external" href="basics.md#plugin-description">‘description’</a>.</p>
<div class="section" id="the-is-deferrable-argument">
<h4>The ‘is_deferrable’ argument<a class="headerlink" href="#the-is-deferrable-argument" title="Permalink to this headline">¶</a></h4>
<p>If this is set to <code class="docutils literal"><span class="pre">True</span></code>, then the variable value lookup will be
deferred until right before the test is run within an allocation. This
allows you to gather information on a node rather than the kickoff host.</p>
<p>Deferred variable values are more restricted. They can be one of: - A
string - A dict with string keys and string values</p>
</div>
<div class="section" id="the-sub-keys-argument">
<h4>The <code class="docutils literal"><span class="pre">sub_keys</span></code> argument<a class="headerlink" href="#the-sub-keys-argument" title="Permalink to this headline">¶</a></h4>
<p>If a variable is <code class="docutils literal"><span class="pre">deferred</span></code> and is expected to return a dict, you must
provide a list of the sub-keys that the return dictionary will contain.
This is so Pavilion can validate any sub-key references made in configs
at test kickoff time.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, LANL Pre-Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.7</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="../_sources/plugins/sys_vars.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>