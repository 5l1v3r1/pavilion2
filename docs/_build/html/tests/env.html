
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Build and Run Environments &#8212; Pavilion2 2.0.0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="build-and-run-environments">
<h1>Build and Run Environments<a class="headerlink" href="#build-and-run-environments" title="Permalink to this headline">¶</a></h1>
<p>Setting up your environment is crucial for running and building tests,
and Pavilion gives you several options for doing so.</p>
<ul class="simple">
<li><a class="reference external" href="#environment-variables">Environment Variables</a></li>
<li><a class="reference external" href="#modules">Modules</a></li>
<li><a class="reference external" href="#module-wrappers">Module Wrappers</a></li>
</ul>
<div class="section" id="assumptions">
<h2>Assumptions<a class="headerlink" href="#assumptions" title="Permalink to this headline">¶</a></h2>
<p>Pavilion assumes that it runs under a relatively clean, default login
environment; ie the login environment a new user might get when they log
into the machine for the first time, including any default modules or
environment variables. This is <strong>not required</strong>, but simply means that
when you run Pavilion, it will work the same as when your co-worker
does.</p>
<p>That aside, most basic changes won’t have a significant impact on
Pavilion. However, a few things will: - Changing from the default
Python3 or PYTHONPATH - Modifying LD_LIBRARY_PATH or similar variables
that affect compilation.</p>
<p>Lastly, Pavilion writes and runs <em>BASH</em> scripts. It assumes that
whatever your environment is, the module system will work under <em>BASH</em>
as just as well as your native environment.</p>
</div>
<div class="section" id="environment-variables">
<h2>Environment Variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">env</span></code> attribute allows you to set environment variables in either
the <em>run</em> or <em>build</em> scripts. They are configured as a YAML
mapping/dict, and (unlike the rest of Pavilion) can have upper-case keys
(but no dashes). Like with the run/build commands, the values are can
contain any bash shell syntax without issue.</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span>env_example:
  run:
    env:
      PYTHONPATH: $(pwd)/libs
      TEST_PARAM1: 37
      AN_ARRAY: {hello world}

    cmds:
      - for value in ${AN_ARRAY[@]}; do echo $value; done
      - python3 mytest.py
</pre></div>
</div>
<p>Each set variable is set (and _exported) in the order given.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>#!/bin/bash

export PYTHONPATH=$(pwd)/libs
export TEST_PARAM1=37
export AN_ARRAY={hello world}

for value in ${AN_ARRAY[@]}; do echo $value; done
python3 mytest.py
</pre></div>
</div>
<div class="section" id="escaping">
<h3>Escaping<a class="headerlink" href="#escaping" title="Permalink to this headline">¶</a></h3>
<p>Values are not quoted. If they need to be, you’ll have to quote them
twice, once for YAML and once for the quotes you actually need.</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span>quote_example:
  run:
    env:
      DQUOTED: &#39;&quot;This will be in double quotes. It is a literal string as far
               as YAML is concerned.&quot;&#39;
      SQUOTED: &quot;&#39;This $VAR will not be resolved in bash, because this is single
               quoted.&#39;&quot;
      DDQUOTED: &quot;&quot;&quot;Double quotes to escape them.&quot;&quot;&quot;
      SSQUOTED: &#39;&quot;That goes for single quotes &#39;&#39; too.&quot;&#39;
      NO_QUOTES: $(echo &quot;YAML only cares about the first character where quotes
                 are concerned.&quot;)
</pre></div>
</div>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>#/bin/bash

export DQUOTED=&quot;This will be in double quotes. It is a literal string as far as YAML is concerned.&quot;
export SQUOTED=&#39;This $VAR will not be resolved in bash, because this is single quoted.&#39;
export DDQUOTED=&quot;Double quotes to escape them.&quot;
export SSQUOTED=&quot;That goes for single quotes &#39;&#39; too.&quot;
export NO_QUOTES=$(echo &quot;YAML only cares about the first character where quotes are concerned.&quot;)
</pre></div>
</div>
</div>
</div>
<div class="section" id="modules">
<h2>Modules<a class="headerlink" href="#modules" title="Permalink to this headline">¶</a></h2>
<p>Many clusters employ module systems to allow for easy switching between
build environments. Pavilion supports both the environment (TCL) and the
LMOD module systems, but other module systems can be supported by
overriding the base <a class="reference external" href="../plugins/module_wrappers.md">module_wrapper
plugin</a>.</p>
<div class="section" id="loading-modules">
<h3>Loading modules<a class="headerlink" href="#loading-modules" title="Permalink to this headline">¶</a></h3>
<p>In either <em>run</em> or <em>build</em> configs, you can have Pavilion import modules
by listing them (in the order needed) under the <em>modules</em> attribute.</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="n">module_example</span><span class="p">:</span>
  <span class="n">build</span><span class="p">:</span>
    <span class="n">modules</span><span class="p">:</span> <span class="p">[</span><span class="n">gcc</span><span class="p">,</span> <span class="n">openmpi</span><span class="o">/</span><span class="mf">2.1</span><span class="o">.</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
<p>In the generated build script, each of these modules will be both loaded
and checked to see if they were actually loaded.</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>#/bin/bash

TEST_ID=$1

module load gcc
# This checks to make sure the module was loaded. If it isn&#39;t the script
# exits and updates the test status.
is_module_loaded gcc $TEST_ID

module load openmpi/2.1.2
is_module_loaded openmpi/2.1.2 $TEST_ID
</pre></div>
</div>
</div>
<div class="section" id="other-module-manipulations">
<h3>Other Module Manipulations<a class="headerlink" href="#other-module-manipulations" title="Permalink to this headline">¶</a></h3>
<p>You can also unload and swap modules.</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span>module_example2:
  build:
    source_location: test_code.xz
  run:
    # This assumes gcc and openmpi are already loaded by default.
    modules [gcc-&gt;intel/18.0.4, -openmpi, intel-mpi]
    cmds:
      - $MPICC -o test_code test_code.c
</pre></div>
</div>
</div>
</div>
<div class="section" id="module-wrappers">
<h2>Module Wrappers<a class="headerlink" href="#module-wrappers" title="Permalink to this headline">¶</a></h2>
<p>Module wrappers allow you to change how Pavilion loads specific modules,
module version, and even modules in general. The default module wrapper
is what provides support for lmod and tmod, generates the source to load
modules within run and build scripts, and check to see if they’ve been
successfully loaded (or unloaded).</p>
<p>For more information on writing these, see <a class="reference external" href="../plugins/module_wrappers.md">Module Wrapper
Plugins</a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, LANL Pre-Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.7</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="../_sources/tests/env.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>