
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Test Format &#8212; Pavilion2 2.0.0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Pavilion Test Variables" href="variables.html" />
    <link rel="prev" title="&lt;no title&gt;" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="test-format">
<h1>Test Format<a class="headerlink" href="#test-format" title="Permalink to this headline">¶</a></h1>
<p>This page contains in-depth documentation on the test format.</p>
<div class="section" id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="#tests-and-suites">Tests and Suites</a></li>
<li><a class="reference external" href="#test-formatting-and-structure">Formatting and Structure</a></li>
<li><a class="reference external" href="#host-configs">Host Configs</a></li>
<li><a class="reference external" href="#mode-configs">Mode Configs</a></li>
<li><a class="reference external" href="#order-of-resolution">Order of Resolution</a></li>
<li><a class="reference external" href="#top-level-test-config-keys">Top Level Test Config Keys</a></li>
</ul>
<div class="section" id="tests-and-suites">
<h3>Tests and Suites<a class="headerlink" href="#tests-and-suites" title="Permalink to this headline">¶</a></h3>
<p>Each Suite is a file (with a <code class="docutils literal"><span class="pre">.yaml</span></code> extension) which can contain
multiple tests. Suite files must reside in <code class="docutils literal"><span class="pre">&lt;config_dir&gt;/tests/</span></code>,
where <code class="docutils literal"><span class="pre">&lt;config_dir&gt;</span></code> is one of your configuration directories. Tests
in a suite can be run as a group or independently, and can even inherit
from one another.</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="c1"># The test will be called supermagic.</span>
<span class="n">supermagic</span><span class="p">:</span>
    <span class="c1"># Use the slurm scheduler</span>
    <span class="n">scheduler</span><span class="p">:</span> <span class="n">slurm</span>

    <span class="c1"># Configure how to build the test. If two tests have identical build</span>
    <span class="c1"># configurations, they will share a build.</span>
    <span class="n">build</span><span class="p">:</span>
      <span class="c1"># This will be searched for in &lt;config_dir&gt;/test_src/ for each of</span>
      <span class="c1"># the known config directories.</span>
      <span class="n">source_location</span><span class="p">:</span> <span class="n">supermagic</span><span class="o">.</span><span class="n">xz</span>
      <span class="c1"># These commands are written into a build script.</span>
      <span class="n">cmds</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">mpicc</span> <span class="o">-</span><span class="n">o</span> <span class="n">super_magic</span> <span class="n">super_magic</span><span class="o">.</span><span class="n">c</span>

    <span class="c1"># Configure how to run the test.</span>
    <span class="n">run</span><span class="p">:</span>
      <span class="c1"># Like with building, these are to generate a script to run the test.</span>
      <span class="c1"># By default, the return result of the last command determines whether</span>
      <span class="c1"># the test result is PASS or FAIL.</span>
      <span class="n">cmds</span><span class="p">:</span>
        <span class="o">-</span> <span class="s2">&quot;srun ./super_magic&quot;</span>

<span class="c1"># We can have more than one test config per suite file.</span>
<span class="n">supermagic2</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="test-formatting-and-structure">
<h3>Test Formatting and Structure<a class="headerlink" href="#test-formatting-and-structure" title="Permalink to this headline">¶</a></h3>
<p>Pavilion uses YAML as the base configuration language, but the structure
of suite files is strictly defined. If you violate these rules, Pavilion
will warn you immediately. You can use whatever advanced YAML constructs
you’d like, as long as the end result still conforms to Pavilion’s
expected structure.</p>
<p>All config keys in pavilion are <strong>lowercase</strong>, including test names.</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Suite files are a YAML mapping at the top level. The key is the test</span>
<span class="c1"># base name, and the value is a strictly defined mapping of the test attributes</span>
<span class="c1"># and sections.</span>
<span class="n">formatting</span><span class="p">:</span>
    <span class="c1"># This (short) description appears when listing tests.</span>
    <span class="n">summary</span><span class="p">:</span> <span class="n">This</span> <span class="n">example</span> <span class="n">explains</span> <span class="n">pavilion</span><span class="o">/</span><span class="n">YAML</span> <span class="n">test</span> <span class="n">formatting</span><span class="o">.</span>

    <span class="c1"># The documentation string is for longer test documentation.</span>
    <span class="n">doc</span><span class="p">:</span> <span class="n">Note</span> <span class="n">that</span> <span class="n">YAML</span> <span class="n">strings</span> <span class="n">only</span> <span class="n">have</span> <span class="n">to</span> <span class="n">be</span> <span class="n">quoted</span> <span class="k">if</span> <span class="n">they</span> <span class="n">contain</span>
         <span class="n">special</span> <span class="n">characters</span><span class="p">,</span> <span class="ow">and</span> <span class="n">can</span> <span class="n">wrap</span> <span class="n">lines</span><span class="o">.</span> <span class="n">The</span> <span class="n">extra</span> <span class="n">tabbing</span> <span class="ow">and</span> <span class="n">newlines</span>
         <span class="n">are</span> <span class="n">automatically</span> <span class="n">removed</span><span class="o">.</span>

         <span class="n">A</span> <span class="n">double</span> <span class="n">newline</span> <span class="n">will</span> <span class="n">force</span> <span class="n">a</span> <span class="n">newline</span><span class="p">,</span> <span class="n">however</span><span class="o">.</span>

         <span class="n">You</span> <span class="n">can</span> <span class="n">also</span> <span class="n">double</span> <span class="n">quote</span> <span class="n">strings</span> <span class="p">(</span><span class="n">which</span> <span class="n">allows</span> <span class="k">for</span> <span class="n">escapes</span><span class="p">),</span>
         <span class="n">single</span> <span class="n">quote</span> <span class="n">strings</span> <span class="p">(</span><span class="n">which</span> <span class="n">interprets</span> <span class="n">them</span> <span class="n">completely</span> <span class="n">literally</span><span class="p">),</span>
         <span class="ow">or</span> <span class="n">use</span> <span class="n">either</span> <span class="n">of</span> <span class="n">the</span> <span class="n">YAML</span> <span class="n">block</span> <span class="n">string</span> <span class="n">styles</span><span class="o">.</span>

    <span class="c1"># This adds to the test name. It&#39;s particularly useful for</span>
    <span class="c1"># permuted tests, as it lets put a generated component in the test name.</span>
    <span class="c1"># {{compiler}} is a pavilion variable reference. We&#39;ll cover that later.</span>
    <span class="n">subtitle</span><span class="p">:</span> <span class="s2">&quot;{{compiler}}&quot;</span>

    <span class="c1"># In this build section, we use YAML &#39;block&#39; style everywhere.</span>
    <span class="c1"># You could also use &#39;flow&#39; style</span>
    <span class="n">build</span><span class="p">:</span>
      <span class="n">modules</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">gcc</span>
        <span class="o">-</span> <span class="n">openmpi</span>
      <span class="n">env</span><span class="p">:</span>
        <span class="n">MPICC</span><span class="p">:</span> <span class="n">mpicc</span>
      <span class="n">cmds</span><span class="p">:</span>
        <span class="o">-</span> <span class="s2">&quot;$MPICC -o formatting formatting.c&quot;</span>

    <span class="c1"># In this run section, we use YAML &#39;flow&#39; formatting everywhere.</span>
    <span class="c1"># You could also use &#39;block&#39; style</span>
    <span class="n">run</span><span class="p">:</span>
      <span class="n">modules</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;gcc&#39;</span><span class="p">,</span> <span class="s1">&#39;openmpi&#39;</span><span class="p">]</span>
      <span class="n">env</span><span class="p">:</span> <span class="p">{</span><span class="n">MPICC</span><span class="p">:</span> <span class="n">mpicc</span><span class="p">}</span>

      <span class="c1"># Anything that accepts a list of values will also accept a single value.</span>
      <span class="c1"># Pavilion will quietly make it a single item list.</span>
      <span class="n">cmds</span><span class="p">:</span> <span class="s2">&quot;./formatting&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="pavilionisms">
<h2>Pavilionisms<a class="headerlink" href="#pavilionisms" title="Permalink to this headline">¶</a></h2>
<p>While YAML is the base configuration language, Pavilion interprets the
values given in some non-standard ways.</p>
<p>All Pavilion (non-structural) test config values are interpreted as
strings.</p>
<p>YAML provides several different data types, but Pavilion forcibly
converts all of them to strings. The bool True becomes “True”, 5 becomes
the string “5”, and so on. This done mostly because it enables Pavilion
variable substitution in any config value. Some Pavilion scheduler and
result parser plugins ask for integer or other specific data types in
their configs. It’s up to those plugins to interpret those values and
report errors.</p>
<p>Many configuration attributes in Pavilion accept a list of values. If
you give a single value instead of a list to such attributes, Pavilion
automatically interprets that as a list of that single value.</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="n">multi</span><span class="o">-</span><span class="n">example</span><span class="p">:</span>
    <span class="n">build</span><span class="p">:</span>
      <span class="c1"># The cmds attribute of both &#39;build&#39; and &#39;run&#39; accepts a list of command</span>
      <span class="c1"># strings.</span>
      <span class="n">cmds</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">echo</span> <span class="s2">&quot;cmd 1&quot;</span>
        <span class="o">-</span> <span class="n">echo</span> <span class="s2">&quot;cmd 2&quot;</span>

    <span class="n">run</span><span class="p">:</span>
      <span class="c1"># If you have only one command, you don&#39;t have to put it in a list.</span>
      <span class="n">cmds</span><span class="p">:</span> <span class="n">echo</span> <span class="s2">&quot;cmd 1&quot;</span>

    <span class="n">variables</span><span class="p">:</span>
      <span class="c1"># Keys in the variables and permutations sections always take a list,</span>
      <span class="c1"># but that list can have mappings as keys. Whether one value or multiple</span>
      <span class="c1"># values is given, Pavilion always sees it as a list.</span>
      <span class="n">foo</span><span class="p">:</span>
        <span class="o">-</span> <span class="p">{</span><span class="n">bar</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="o">-</span> <span class="p">{</span><span class="n">bar</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
      <span class="n">baz</span><span class="p">:</span> <span class="p">{</span><span class="n">buz</span><span class="p">:</span> <span class="s2">&quot;hello&quot;</span><span class="p">}</span>
</pre></div>
</div>
<div class="section" id="host-configs">
<h3>Host Configs<a class="headerlink" href="#host-configs" title="Permalink to this headline">¶</a></h3>
<p>Host configs allow you to have per-host settings. These are layered on
top of the general defaults for every test run on a particular host.
They are <code class="docutils literal"><span class="pre">&lt;name&gt;.yaml</span></code> files that go in the <code class="docutils literal"><span class="pre">&lt;config_dir&gt;/hosts/</span></code>
directory, in any of your <a class="reference external" href="../config.md">config directories</a>.</p>
<p>Pavilion determines your current host through the <code class="docutils literal"><span class="pre">sys_name</span></code> system
variable. The default plugin simply uses the short hostname, but it’s
recommended to add a plugin that gives a system name that generically
refers to the entire cluster.</p>
<p>You can specify the host config with the <code class="docutils literal"><span class="pre">-H</span></code> option to the
<code class="docutils literal"><span class="pre">pav</span> <span class="pre">run</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pav</span> <span class="n">run</span> <span class="o">-</span><span class="n">H</span> <span class="n">another_host</span> <span class="n">my_tests</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="format">
<h2>Format<a class="headerlink" href="#format" title="Permalink to this headline">¶</a></h2>
<p>Host configs are a test config, and accept every option that a test
config does. The test attributes are all at the top level; there’re no
test names here.</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="n">scheduler</span><span class="p">:</span> <span class="n">slurm</span>
<span class="n">slurm</span><span class="p">:</span>
    <span class="n">partition</span><span class="p">:</span> <span class="n">user</span>
    <span class="n">qos</span><span class="p">:</span> <span class="n">user</span>
</pre></div>
</div>
<div class="section" id="mode-configs">
<h3>Mode Configs<a class="headerlink" href="#mode-configs" title="Permalink to this headline">¶</a></h3>
<p>Mode configs are exactly like host configs, except you can have more
than one of them. They’re meant for applying extra defaults to tests
that are situational. They are <code class="docutils literal"><span class="pre">&lt;name&gt;.yaml</span></code> files that go in the
<code class="docutils literal"><span class="pre">&lt;config_dir&gt;/modes/</span></code> directory, in any of your <a class="reference external" href="../config.md">config
directories</a>.</p>
<p>For instance, if you regularly run on the <code class="docutils literal"><span class="pre">dev</span></code> partition, you might
have a <code class="docutils literal"><span class="pre">&lt;config_dir&gt;/modes/dev.yaml</span></code> file to set that up for you.</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="n">slurm</span><span class="p">:</span>
    <span class="n">partition</span><span class="p">:</span> <span class="n">dev</span>
    <span class="n">account</span><span class="p">:</span> <span class="n">dev_user</span>
</pre></div>
</div>
<p>You could then add the mode when starting tests with the <code class="docutils literal"><span class="pre">-m</span></code> option:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pav</span> <span class="n">run</span> <span class="o">-</span><span class="n">m</span> <span class="n">dev</span> <span class="n">my_tests</span>
</pre></div>
</div>
</div>
<div class="section" id="order-of-resolution">
<h3>Order of Resolution<a class="headerlink" href="#order-of-resolution" title="Permalink to this headline">¶</a></h3>
<p>The various features of test configs are resolved in a very particular
order.</p>
<ol class="arabic simple">
<li>Each test is loaded and different configs are overlaid as follows;
later items take precedence in conflicts.<ol class="arabic" start="2">
<li>The general defaults.</li>
<li>The host config.</li>
<li>Any mode configs in the order specified.</li>
<li>The actual test config.</li>
</ol>
</li>
<li>Inheritance is resolved.</li>
<li>Tests are filtered down to only those requested.</li>
<li>Command line overrides (‘-c’) are applied.</li>
<li>Permutations are resolved.</li>
<li>Variables in the chosen scheduler config section are resolved. (You
should’t have <code class="docutils literal"><span class="pre">sched</span></code> variables in these sections.)</li>
<li>Variables are resolved throughout the rest of the config.</li>
</ol>
<p>This results in the final test config.</p>
</div>
<div class="section" id="top-level-test-config-keys">
<h3>Top Level Test Config Keys<a class="headerlink" href="#top-level-test-config-keys" title="Permalink to this headline">¶</a></h3>
<div class="section" id="inherits-from">
<h4>inherits_from<a class="headerlink" href="#inherits-from" title="Permalink to this headline">¶</a></h4>
<p>Sets the test (by test base name) that this test inherits from, out of
the tests in this suite file. The resulting test will be composed of all
keys in the test it inherits from, plus any specified in this test
config. See <a class="reference external" href="../advanced.md#inheritance">Inheritance</a> in the advanced
pavilion overview.</p>
</div>
<div class="section" id="subtitle">
<h4>subtitle<a class="headerlink" href="#subtitle" title="Permalink to this headline">¶</a></h4>
<p>This will be added to the test name for logging and documentation
purposes. A test named <code class="docutils literal"><span class="pre">foo</span></code> with a subtitle of <code class="docutils literal"><span class="pre">bar</span></code> will be
referred to as <code class="docutils literal"><span class="pre">foo.bar</span></code>. It provides a place where you can add
variable or permutation specific naming to a test. Subtitles appear in
logs and when printing information about tests, but subtitles aren’t
considered when selecting tests to run.</p>
</div>
<div class="section" id="summary">
<h4>summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h4>
<p>The short test summary. Pavilion will include this description when it
lists tests, but only the first 100 characters will be printed.</p>
</div>
<div class="section" id="doc">
<h4>doc<a class="headerlink" href="#doc" title="Permalink to this headline">¶</a></h4>
<p>A longer documentation string for a test.</p>
</div>
<div class="section" id="variables">
<h4>variables<a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h4>
<p>A mapping of variables that are specific to this test. Each variable
value can be a string, a list of strings, a mapping of strings, or a
list of mappings (with the same keys) of strings. See the
<a class="reference external" href="variables.md">variables</a> documentation for more info.</p>
</div>
<div class="section" id="permutations">
<h4>permutations<a class="headerlink" href="#permutations" title="Permalink to this headline">¶</a></h4>
<p>Like variables, but multi-valued items will generate test permutations
for all combinations of the (used) permutation variables. See the
<a class="reference external" href="variables.md#permutations">Permutations</a> documentation.</p>
</div>
<div class="section" id="scheduler">
<h4>scheduler<a class="headerlink" href="#scheduler" title="Permalink to this headline">¶</a></h4>
<p>Sets the scheduler for this test. Defaults to ‘raw’. It’s recommended to
set this in your host configs.</p>
</div>
<div class="section" id="build">
<h4>build<a class="headerlink" href="#build" title="Permalink to this headline">¶</a></h4>
<p>This sub-section defines how the test source is built.</p>
<p>See <a class="reference external" href="build.md">Builds</a> for the sub-section keys and usage.</p>
</div>
<div class="section" id="run">
<h4>run<a class="headerlink" href="#run" title="Permalink to this headline">¶</a></h4>
<p>This sub-section defines how the test source is run.</p>
<p>See <a class="reference external" href="run.md">Run</a> for the sub-section keys and usage.</p>
</div>
<div class="section" id="results">
<h4>results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h4>
<p>This sub-section defines how test results are parsed.</p>
<p>See <a class="reference external" href="results.md">Results</a> for the sub-section keys and usage.</p>
</div>
<div class="section" id="schedulers">
<h4>&lt;schedulers&gt;<a class="headerlink" href="#schedulers" title="Permalink to this headline">¶</a></h4>
<p>Each loaded scheduler plugin defines a sub-section for configuring that
scheduler, such as <code class="docutils literal"><span class="pre">slurm</span></code> and <code class="docutils literal"><span class="pre">raw</span></code>.</p>
<p>To see documentation on these, use
<code class="docutils literal"><span class="pre">pav</span> <span class="pre">show</span> <span class="pre">sched</span> <span class="pre">--config</span> <span class="pre">&lt;scheduler&gt;</span></code> to get the config documentation
for that scheduler.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">&lt;no title&gt;</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">&lt;no title&gt;</a></li>
      <li>Next: <a href="variables.html" title="next chapter">Pavilion Test Variables</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, LANL Pre-Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.7</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="../_sources/tests/format.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>